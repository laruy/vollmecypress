name: Cypress Tests
on:
  push:
    branches: [ main ]
  workflow_dispatch: {}

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'npm'

      - name: Start Web App FrontEnd
        run: |
          cd web
          npm install
          npm start &

      - name: Run Cypress Tests
        uses: cypress-io/github-action@v6
        with:
          spec: |
            cypress/e2e/cadastro-sucesso.cy.js
            cypress/e2e/login-clinica.cy.js
            cypress/e2e/dashboard.cy.js
          wait-on: 'http://localhost:3000,https://vollmecypress-server-1.onrender.com'

      # - name: Run Cypress (start + wait-on)
      #   uses: cypress-io/github-action@v6
      #   with:
      #     #  aqui roda na raiz, n√£o em web
      #     working-directory: .
      #     # sobe o front na pasta web
      #     start: npm start --prefix web
      #     wait-on: http://localhost:3000, https://vollmecypress-server-1.onrender.com
      #     wait-on-timeout: 180
      #     config: baseUrl=http://localhost:3000
      #     spec: |
      #       cypress/e2e/cadastro-sucesso.cy.js
      #       cypress/e2e/login-clinica.cy.js
      #       cypress/e2e/dashboard.cy.js
      #     record: true
      #     parallel: true
      #     group: 'Cypress Tests'
      #   env:
      #     API_URL: https://vollmecypress-server-1.onrender.com
      #     CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
